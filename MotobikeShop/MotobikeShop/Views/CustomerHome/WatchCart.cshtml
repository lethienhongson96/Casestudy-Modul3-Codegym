@model List<CartItem>

@inject AppDbContext context;
@inject Microsoft.AspNetCore.Identity.SignInManager<ApplicationUser> _signInManager;
@{
    List<Product> products = context.Products.ToList();
    var CurrentAccount = _signInManager.UserManager.GetUserAsync(User).Result;
    double totalOrder = 0;
}
@if (_signInManager.IsSignedIn(User))
{
    <div>
        <a href="javascript:void(0)" onclick="CustomerCart.OrderByAccount('@CurrentAccount.Id')" style="margin-left:1050px">
            Đặt Hàng
        </a>
    </div>
}
@*else
{
    <div>
        <a style="margin-left:1050px" href="javascript:void(0)" onclick="CustomerCart.OrderByInfo(@CurrentAccount.Id)">
            Đặt Hàng
        </a>
    </div>
}*@
<table class="table" id="ProductIndex">
    <thead class="thead-dark" style="text-align:center">
        <tr>
            <th scope="col">Tên sản phẩm</th>
            <th scope="col">Số Lượng</th>
            <th scope="col">Hình ảnh</th>
            <th scope="col">Giá</th>
        </tr>
    </thead>
    <tbody style="text-align:center">
        @foreach (var item in Model)
        {
            <tr>
                @{ double total = item.Amount * products.Find(el => el.Id == item.ProductId).PricePerUnit; }
                <td>@products.Find(el => el.Id == item.ProductId).Name</td>
                <td>@item.Amount</td>
                <td>
                    <img src="~/Images/ProductImages/@products.Find(el => el.Id == item.ProductId).ImagePath"
                         style="height:70px;width:70px" />
                </td>
                <td>@total.ToString("N0")</td>
                @{totalOrder += total; }
            </tr>
        }
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td>Tổng Tiền: <span class="text-danger">@totalOrder.ToString("N0")</span></td>
        </tr>
    </tbody>
</table>

@section Scripts{
    <script src="~/js/CustomerCart.js" asp-append-version="true"></script>
}